import{r as i,c as t,h as s,F as n,a as e}from"./p-3b8a929f.js";const l={LOADING:"loading",INTRO:"intro",GAME:"game"},d=class{constructor(s){i(this,s),this.trainningEnd=t(this,"trainningEnd",7),this.error=[],this.selecteds=[],this.step=l.LOADING,this.showTip=!0,this.showInfo=!0,this.dropAttr={onDragOver:i=>this.handleDragOver(i),onDragEnter:i=>this.handleDragEnter(i),onDragLeave:i=>this.handleDragLeave(i),onDrop:i=>this.handleDrop(i)}}handleCloseFeedback(){this.feedback&&(this.feedback.isPositive||(this.showTip=!0),this.feedback.isLast&&(this.trainningEnd.emit({trainning:this._id}),this.reset()),this.feedback=null)}verify(i){return i.id===this.sequence[this.selecteds.length]}showNegativeFeedback(i){this.feedback={thumb:i.thumb,text:i.negative,isPositive:!1}}showPositiveFeedback(i){var t,s;this.feedback={thumb:i.thumb,text:i.positive,isPositive:!0,isLast:(null===(t=this.selecteds)||void 0===t?void 0:t.length)===(null===(s=this.sequence)||void 0===s?void 0:s.length)}}handleDragStart(i){this.showInfo=!1,i.dataTransfer.setData("text/plain",i.target.id)}handleDragOver(i){i.preventDefault()}handleDrop(i){var t,s,n;i.preventDefault(),this.handleDragLeave(i);const e=i.dataTransfer.getData("text"),l=null===(t=this.data)||void 0===t?void 0:t.find((i=>i.id===e));if(this.verify(l)){const i=[...this.data];i[null===(s=this.data)||void 0===s?void 0:s.findIndex((i=>i.id===e))].selected=!0,this.data=i,this.selecteds.push(null===(n=this.data)||void 0===n?void 0:n.find((i=>i.id===e))),this.showTip=!1,this.showPositiveFeedback(l)}else this.showNegativeFeedback(l);i.dataTransfer.clearData()}handleDragEnter(i){i.target.classList.add("active")}handleDragLeave(i){i.target.classList.remove("active")}setError(i){const t=[...this.error,i];this.error=t}validateFetchedData(i){i?(i.title||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `title`"),".")),i.intro||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `intro`"),".")),i.info||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `info`"),".")),i.sequence&&i.sequence.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `sequence`"),".")),i.items&&i.items.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `items`"),".")),i.dropzone||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `dropzone`"),"."))):this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((i=>i.json())).then((i=>{var t,s;this.validateFetchedData(i),this.title=null==i?void 0:i.title,this.intro=null==i?void 0:i.intro,this.info=null==i?void 0:i.info,this.dropImage=null==i?void 0:i.dropzone,this.sequence=null==i?void 0:i.sequence,this.data=null===(t=i.items)||void 0===t?void 0:t.map((i=>Object.assign(Object.assign({},i),{selected:!1}))),(null==i?void 0:i.background)&&(this.hostElem.style.backgroundImage=`url(${i.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step=l.INTRO)})).catch((i=>{this.setError(s("span",null,"Fetched response is invalid:",null==i?void 0:i.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `config`"),".")))}reset(){this.selecteds=[],this.step=l.loading,this.showTip=!0,this.showInfo=!0,this.init()}renderTip(i,t,n,e){return s("span",{class:`c-ordered-tutorial-tip ${t}`},i,Boolean(e)&&s("button",{onClick:e},n))}render(){var i,t,d,o,a,r,h,c,u=this.step!==l.LOADING&&this.data.find((i=>(null==i?void 0:i.id)===this.sequence[this.selecteds.length]));return s(e,{class:"c-ordered-dnd c-ordered-trainning",ref:i=>this.hostElem=i},this.step!==l.LOADING?s(n,null,s("header",{class:"c-ordered-header"},s("h2",{class:"c-ordered-header-title"},this.title)),s("div",{class:"c-ordered-container"},s("div",{class:"c-ordered-container-info "+(this.showInfo?"show":"hide")},s("div",{class:"c-ordered-container-info-container"},s("div",{class:"c-ordered-container-info-text"},s("div",{class:"desc"},this.step===l.INTRO?s(n,null,s("p",null,this.intro),s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.step=l.GAME},"ComeÃ§ar")):s(n,null,s("h3",null,null===(i=this.info)||void 0===i?void 0:i.title),s("p",null,null===(t=this.info)||void 0===t?void 0:t.text)))),this.step===l.GAME&&s("div",{class:"c-ordered-container-info-control"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right"))))),s("div",Object.assign({class:"c-ordered-container-stage"},this.dropAttr),this.dropImage&&s("img",{src:this.dropImage,alt:""}),(null===(d=this.selecteds)||void 0===d?void 0:d.length)>0&&(null===(o=[...this.data])||void 0===o?void 0:o.reverse().map((i=>this.selecteds.find((t=>t.id===i.id))?s("img",{src:i.image,class:"preview",alt:""}):"")))),s("div",{class:"c-ordered-container-options"},s("span",{class:"c-ordered-tutorial-tip left-top "+(this.step!==l.INTRO&&!Boolean(this.feedback)&&this.showTip?"show":"hide")},null===(a=this.info)||void 0===a?void 0:a.tip),this.renderTip(null===(r=this.info)||void 0===r?void 0:r.tip,"left-top "+(this.step!==l.INTRO&&!Boolean(this.feedback)&&this.showTip?"show":"hide")),s("div",{class:"c-ordered-container-options-scroll"},this.step!==l.INTRO&&(null===(h=this.data)||void 0===h?void 0:h.map((i=>s("div",{id:i.id,class:`c-ordered-container-options-item ${i.id===(null==u?void 0:u.id)?"active u-simple-pulse":""} ${Boolean(this.feedback)?"disabled":""}`,draggable:/*!item.selected &&*/!Boolean(this.feedback),onDragStart:i=>this.handleDragStart(i),style:{backgroundImage:`url(${i.thumb})`}}))))))),this.feedback&&s("yduqs-modal",{size:"small",variant:"lab",isopen:!0,id:`${this._id}-feedback-modal`},s("div",{class:"c-ordered-modal-feedback"},s("div",{class:"content"},s("div",{class:"thumb"},s("img",{class:"image",src:this.feedback.thumb,alt:""}),s("span",{class:"material-icons badge "+(this.feedback.isPositive?"success":"error")},this.feedback.isPositive?"check_circle":"cancel")),s("p",null,this.feedback.text)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},"Continuar"))))):s(n,null,"Loading...",(null===(c=this.error)||void 0===c?void 0:c.length)>0&&s("dl",null,s("dt",null,"Errors"),this.error.map((i=>s("dd",null,i))))))}};export{d as yduqs_ordered_dnd_trainning}