import{r as s,c as t,h as i,F as e,a as l}from"./p-3b8a929f.js";const o={LOADING:"loading",INFO:"info",GAME:"game"},a=class{constructor(i){s(this,i),this.challengeEnd=t(this,"challengeEnd",7),this.error=[],this.step=o.LOADING,this.showInfo=!0,this.usedChances=0,this.stageAttr={onMouseMove:s=>this.getPos(s),onMouseLeave:()=>this.handleCursorLeave(),onTouchStart:s=>this.getPos(s),onTouchMove:s=>this.getPos(s),onTouchEnd:()=>this.handleCursorLeave()}}handleGameOver(){this.gameover()}setError(s){const t=[...this.error,s];this.error=t}validateFetchedData(s){s?(s.title||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `title`"),".")),s.info||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `info`"),".")),s.items&&s.items.length||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `items`"),"."))):this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((s=>s.json())).then((s=>{var t;this.validateFetchedData(s),this.title=null==s?void 0:s.title,this.info=null==s?void 0:s.info,this.items=null==s?void 0:s.items,this.chances=(null==s?void 0:s.chances)||3,(null==s?void 0:s.background)&&(this.hostElem.style.backgroundImage=`url(${s.background})`),this.selected=this.items[0],(null===(t=this.error)||void 0===t?void 0:t.length)||(this.step=o.INFO)})).catch((s=>{this.setError(i("span",null,"Fetched response is invalid:",null==s?void 0:s.toString()))}))}async gameover(){this.usedChances=0,this.reset(),this.step=o.INFO}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid attribute `id`"),".")),this.config||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid attribute `config`"),".")))}getPos(s){if(s.preventDefault(),this.step!==o.GAME)return;let t,i,e,l;const a=s.target.getBoundingClientRect();if("touchstart"==s.type||"touchmove"==s.type||"touchend"==s.type||"touchcancel"==s.type){const e=(s.originalEvent||s).touches[0]||(s.originalEvent||s).changedTouches[0];t=e.pageX-a.left,i=e.pageY-a.top}else"mousedown"!=s.type&&"mouseup"!=s.type&&"mousemove"!=s.type&&"mouseover"!=s.type&&"mouseout"!=s.type&&"mouseenter"!=s.type&&"mouseleave"!=s.type||(t=s.clientX-a.left,i=s.clientY-a.top);e=t-this.displayElem.clientWidth/2,l=i-this.displayElem.clientHeight-20;const n=this.displayImg.clientWidth/this.stageElem.clientWidth*t-this.displayElem.clientWidth/2,h=this.displayImg.clientHeight/this.stageElem.clientHeight*i-this.displayElem.clientHeight/2;this.displayImg.style.left=`${n>0?-Math.abs(n):Math.abs(n)}px`,this.displayImg.style.top=`${h>0?-Math.abs(h):Math.abs(h)}px`,e+this.displayElem.clientWidth>this.stageElem.clientWidth&&(e=e-(e+this.displayElem.clientWidth-this.stageElem.clientWidth)-5),l+a.top<0&&(l=i+20),this.displayElem.style.opacity="1",this.displayElem.style.left=`${e}px`,this.displayElem.style.top=`${l}px`}next(s){const t=[...this.sequence||[]];t.push(s),this.sequence=t,this.items.length>this.sequence.length?this.selected=this.items[this.sequence.length]:(this.step=o.FEEDBACK,this.feedback=this.sequence.every(((s,t)=>s===this.items[t].approved))?{text:"Texto do Feedback POSITIVO",isPositive:!0}:{text:"Texto do Feedback NEGATIVO",isPositive:!1})}handleCloseFeedback(){var s;this.showInfo=!0,this.step===o.FEEDBACK&&((null===(s=this.feedback)||void 0===s?void 0:s.isPositive)?(this.challengeEnd.emit({challenge:this._id,result:!0}),this.usedChances=0,this.reset()):(this.usedChances+=1,this.usedChances===this.chances?(this.challengeEnd.emit({challenge:this._id,result:!1}),this.gameover()):this.reset()))}reset(){this.sequence=[],this.selected=this.items[0],this.step=o.GAME}handleCursorLeave(){this.step===o.GAME&&(this.displayElem.style.opacity="0")}render(){var s,t,a;return i(l,{class:"c-zoom c-zoom-challenge",ref:s=>this.hostElem=s},this.step!==o.LOADING?i(e,null,i("header",{class:"c-zoom-header"},i("h2",{class:"c-zoom-header-title"},this.title),i("div",{class:"c-ordered-header-items"},i("div",{class:"c-ordered-header-chances"},[...Array(this.chances)].map(((s,t)=>(s||!s)&&t<this.chances-this.usedChances?i("i",{class:"material-icons active"},"favorite"):i("i",{class:"material-icons"},"favorite_border")))))),i("div",{class:"c-zoom-container"},i("div",{class:"c-zoom-container-info"},i("div",{class:"c-zoom-container-info-container"},i("div",{class:"c-zoom-container-info-text"},this.step===o.INFO&&i(e,null,i("div",{class:"desc"},i("p",null,this.info)),i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.step=o.GAME},"ComeÃ§ar")),this.step!==o.INFO&&i(e,null,i("div",{class:"desc"},i("p",null,this.selected.text)),i("div",{class:"btn-div"},i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.next(!0)},i("i",{class:"material-icons"},"check"),"Aprovar")),i("div",{class:"btn-div"},i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.next(!1)},i("i",{class:"material-icons"},"close"),"Reprovar")))))),i("div",{class:"c-zoom-container-stage"},i("div",Object.assign({class:"img",ref:s=>this.stageElem=s},this.stageAttr),i("img",{src:this.selected.thumb,alt:""}),this.step===o.GAME&&i("div",{class:"c-zoom-container-stage-preview",ref:s=>this.displayElem=s},i("img",{src:this.selected.image,alt:"",ref:s=>this.displayImg=s}))))),this.step===o.FEEDBACK&&i("yduqs-modal",{variant:"lab",size:"small",id:`${this._id}-feedback-modal`,isopen:!0},i("div",{class:"c-zoom-modal-feedback"},i("div",{class:"content"},i("p",null,null===(s=this.feedback)||void 0===s?void 0:s.text)),!(null===(t=this.feedback)||void 0===t?void 0:t.isPositive)&&i("div",{class:"result"},this.sequence.map(((s,t)=>{var e,l;return i("div",{class:"item"},i("img",{src:null===(e=this.items[t])||void 0===e?void 0:e.image,alt:""}),s===(null===(l=this.items[t])||void 0===l?void 0:l.approved)?i("i",{class:"material-icons icon success"},"sentiment_very_satisfied"):i("i",{class:"material-icons icon error"},"sentiment_dissatisfied"))}))),i("footer",null,i("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},this.feedback.isPositive?"Continuar":this.usedChances+1===this.chances?"Voltar para Teoria":"Tentar outra vez"))))):i(e,null,"Loading...",(null===(a=this.error)||void 0===a?void 0:a.length)>0&&i("dl",null,i("dt",null,"Errors"),this.error.map((s=>i("dd",null,s))))))}};export{a as yduqs_zoom_challenge}