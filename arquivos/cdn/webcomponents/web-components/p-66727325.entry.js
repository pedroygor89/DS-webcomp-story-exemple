import{r as t,c as i,h as s,F as e,a as n}from"./p-3b8a929f.js";const l=class{constructor(s){t(this,s),this.challengeEnd=i(this,"challengeEnd",7),this.error=[],this.usedChances=0,this.usedTips=0,this.showTip=!1,this.selecteds=[],this.step="loading",this.tutorialItem="tips",this.result=!0,this.showInfo=!0,this.inCountdownDanger=!1,this.ordered=!0,this.dropAttr={onDragOver:t=>this.handleDragOver(t),onDragEnter:t=>this.handleDragEnter(t),onDragLeave:t=>this.handleDragLeave(t),onDrop:t=>this.handleDrop(t)}}handleCountdownFinished(t){var i;t.detail===(null===(i=this.countdownElem)||void 0===i?void 0:i.id)&&(this.showFeedback="negative",this.step="feedback")}handleCountdownDanger(t){var i;t.detail===(null===(i=this.countdownElem)||void 0===i?void 0:i.id)&&(this.inCountdownDanger=!0)}handleGameOver(){this.gameover()}verify(t){return this.ordered?t.id===this.sequence[this.selecteds.length]:this.sequence.includes(t.id)}handleDragStart(t,i){i?t.preventDefault():(this.showInfo=!1,t.dataTransfer.setData("text/plain",t.target.id),t.currentTarget.classList.add("active"))}handleDragEnd(t){t.currentTarget.classList.remove("active")}handleDragOver(t){t.preventDefault()}handleDrop(t){var i,s,e;t.preventDefault(),this.handleDragLeave(t);const n=t.dataTransfer.getData("text"),l=null===(i=this.data)||void 0===i?void 0:i.findIndex((t=>t.id===n));this.verify(this.data[l])||(this.result=!1);const a=[...this.data];a[l].selected=!0,this.data=a,this.selecteds.push(this.data[l]),this.showTip=!1,(null===(s=this.selecteds)||void 0===s?void 0:s.length)===(null===(e=this.sequence)||void 0===e?void 0:e.length)&&(this.showFeedback=this.result?"positive":"negative",this.step="feedback",this.time&&this.countdownElem.pause()),t.dataTransfer.clearData()}handleDragEnter(t){t.target.classList.add("active")}handleDragLeave(t){t.target.classList.remove("active")}handleTip(){"game"===this.step&&(this.showTip||(this.usedTips+=1),this.showTip=!0)}reset(t){this.usedTips=0,this.showFeedback=null,this.selecteds=[],this.step="game",this.showTip=!1,this.result=!0,this.inCountdownDanger=!1,this.data=this.data.map((t=>Object.assign(Object.assign({},t),{selected:!1}))),this.time&&(t?this.countdownElem.stop():this.countdownElem.restart())}async gameover(){return this.usedChances=0,this.reset(!0),this.step="info",Promise.resolve()}setError(t){const i=[...this.error,t];this.error=i}validateFetchedData(t){t?(t.title||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `title`"),".")),t.info||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `info`"),".")),t.sequence&&t.sequence.length||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `sequence`"),".")),t.items&&t.items.length||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `items`"),".")),t.positiveFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `positiveFeedback`"),".")),t.negativeFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `negativeFeedback`"),".")),t.failFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `failFeedback`"),".")),t.dropzone||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `dropzone`"),"."))):this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((t=>t.json())).then((t=>{var i,s;this.validateFetchedData(t),this.chances=(null==t?void 0:t.chances)||3,this.ordered=!Boolean(null==t?void 0:t.unordered),this.tips=this.ordered?(null==t?void 0:t.tips)||2:0,this.time=null==t?void 0:t.time,this.title=null==t?void 0:t.title,this.info=null==t?void 0:t.info,this.sequence=null==t?void 0:t.sequence,this.positiveFeedback=null==t?void 0:t.positiveFeedback,this.negativeFeedback=null==t?void 0:t.negativeFeedback,this.failFeedback=null==t?void 0:t.failFeedback,this.dropImage=null==t?void 0:t.dropzone,this.data=null===(i=t.items)||void 0===i?void 0:i.map((t=>Object.assign(Object.assign({},t),{selected:!1}))),0===this.tips&&(this.tutorialItem="chances"),(null==t?void 0:t.background)&&(this.hostElem.style.backgroundImage=`url(${t.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step="info")})).catch((t=>{this.setError(s("span",null,"Fetched response is invalid:",null==t?void 0:t.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid attribute `config`"),".")))}handleNextTutorial(t){var i;"tips"===t?this.tutorialItem="chances":"time"===t||"chances"===t&&!this.time?(this.tutorialItem=void 0,this.step="game",null===(i=this.countdownElem)||void 0===i||i.start()):"chances"===t&&(this.tutorialItem="time")}handleCloseFeedback(){this.showInfo=!0,"feedback"===this.step&&("positive"===this.showFeedback?(this.challengeEnd.emit({challenge:this._id,result:!0}),this.usedChances=0,this.reset()):(this.usedChances+=1,this.usedChances===this.chances?(this.challengeEnd.emit({challenge:this._id,result:!1}),this.gameover()):this.reset()))}renderTip(t,i,e,n){return s("span",{class:`c-ordered-tutorial-tip ${i}`},t,Boolean(n)&&s("button",{type:"button",class:"c-button "+(Boolean(e)?"u-text--small":"c-button__icon-container c-button__icon-small u-text--small p-btn"),onClick:n},Boolean(e)?e:s("i",{class:"p-btn c-button__icon material-icons"},"chevron_right")))}getResultIcon(t){let i;return i=this.ordered?this.selecteds[t].id===this.sequence[t]:this.sequence.includes(this.selecteds[t].id),s("i",{class:"material-icons icon "+(i?"success":"error")},i?"sentiment_very_satisfied":"sentiment_dissatisfied")}startTutorial(){this.tutorialItem="tips",this.step="tutorial"}render(){var t,i,l,a,o,h,d,r="loading"!==this.step&&(null===(t=this.data)||void 0===t?void 0:t.find((t=>t.id===this.sequence[this.selecteds.length])));return s(n,{class:"c-ordered-dnd c-ordered-challenge",ref:t=>this.hostElem=t},"loading"!==this.step?s(e,null,"tutorial"===this.step&&s("div",{class:"c-ordered-tutorial-overlay"}),s("header",{class:"c-ordered-header"},s("h2",{class:"c-ordered-header-title"},this.title),s("div",{class:"c-ordered-header-items"},s("div",{class:"c-ordered-header-chances"},[...Array(this.chances)].map(((t,i)=>(t||!t)&&i<this.chances-this.usedChances?s("i",{class:"material-icons active"},i+1===this.chances-this.usedChances&&this.inCountdownDanger?"heart_broken":"favorite"):s("i",{class:"material-icons"},"favorite_border"))),"tutorial"===this.step&&"chances"===this.tutorialItem&&this.renderTip(`Você tem ${this.chances} tentativas`,"bottom",void 0,(()=>this.handleNextTutorial("chances")))),this.time&&s("div",{class:"c-ordered-countdown"},s("yduqs-countdown",{id:`${this._id}-countdown`,time:60*this.time,ref:t=>this.countdownElem=t}),"tutorial"===this.step&&"time"===this.tutorialItem&&this.renderTip("Cuidado para não ultrapassar o tempo.","bottom","Começar",(()=>this.handleNextTutorial("time")))))),s("div",{class:"c-ordered-container"},s("div",{class:"c-ordered-container-info "+("tutorial"===this.step?"noIndex":this.showInfo?"show":"hide")},s("div",{class:"c-ordered-container-info-container"},s("div",{class:"c-ordered-container-info-text"},s("div",{class:"desc"},s("p",null,this.info),"info"===this.step&&s(e,null,s("div",{style:{display:"flex"}},s("button",{type:"button",style:{marginRight:"15px"},class:"c-button u-text--small",onClick:()=>this.startTutorial()},"Tutorial"),s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleNextTutorial("time")},"Começar")))),("tutorial"===this.step||"game"===this.step)&&this.tips>0&&s("div",{class:"btn-tips"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",disabled:this.usedTips>=this.tips||this.showTip,onClick:()=>this.handleTip()},this.usedTips<this.tips&&!this.showTip&&s("span",{class:"c-badge"},this.tips-this.usedTips),s("i",{class:"p-btn c-button__icon material-icons"},"lightbulb")),this.showTip&&s("div",{class:"text"},s("h5",null,"Dica"),s("p",null,r.tip)),"tutorial"===this.step&&"tips"===this.tutorialItem&&this.renderTip(`Use a Dica até ${this.tips} vez${1!==this.tips?"es":""}`,"top-left",void 0,(()=>this.handleNextTutorial("tips"))))),("tutorial"===this.step||"game"===this.step)&&s("div",{class:"c-ordered-container-info-control"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right"))))),s("div",Object.assign({class:"c-ordered-container-stage "+("tutorial"===this.step?"noIndex":"")},this.dropAttr),this.dropImage&&s("img",{src:this.dropImage,class:"dropimage",alt:""}),(null===(i=this.selecteds)||void 0===i?void 0:i.length)>0&&(null===(l=[...this.data])||void 0===l?void 0:l.reverse().map((t=>this.selecteds.find((i=>i.id===t.id))?s("img",{src:t.image,class:"preview",alt:""}):"")))),s("div",{class:"c-ordered-container-options"},s("div",{class:"c-ordered-container-options-scroll"},"info"!==this.step&&(null===(a=this.data)||void 0===a?void 0:a.map((t=>{const i="game"!==this.step||t.selected||Boolean(this.showFeedback);return s("div",{id:t.id,class:"c-ordered-container-options-item "+(i?"disabled":""),draggable:!i,onDragStart:t=>this.handleDragStart(t,i),onDragEnd:t=>this.handleDragEnd(t),style:{backgroundImage:`url(${t.thumb})`}})})))))),"feedback"===this.step&&s("yduqs-modal",{variant:"lab",size:"small",id:`${this._id}-feedback-modal`,isopen:!0},s("div",{class:"c-ordered-modal-feedback"},"positive"===this.showFeedback?s(e,null,s("div",{class:"content"},s("p",null,this.positiveFeedback)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},"Continuar"))):s(e,null,(null===(o=this.selecteds)||void 0===o?void 0:o.length)>0&&(null===(h=this.selecteds)||void 0===h?void 0:h.length)===this.sequence.length?s(e,null,s("div",{class:"content"},s("p",null,this.usedChances+1===this.chances?this.failFeedback:this.negativeFeedback)),s("div",{class:"result"},this.selecteds.map(((t,i)=>s("div",{class:"item"},s("img",{src:null==t?void 0:t.thumb,alt:""}),this.getResultIcon(i)))))):s("div",{class:"content"},s("p",null,"Foi por pouco! Você não finalizou a atividade a tempo e perdeu uma vida.")," ",this.usedChances+1===this.chances&&s("p",null,this.failFeedback)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},this.usedChances+1===this.chances?"Voltar para Teoria":"Tentar outra vez")))))):s(e,null,"Loading...",(null===(d=this.error)||void 0===d?void 0:d.length)>0&&s("dl",null,s("dt",null,"Errors"),this.error.map((t=>s("dd",null,t))))))}};export{l as yduqs_ordered_dnd_challenge}