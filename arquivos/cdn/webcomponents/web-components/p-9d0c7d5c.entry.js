import{r as t,h as s,F as i,a as l}from"./p-3b8a929f.js";const n=class{constructor(s){t(this,s),this.error=[],this.step="loading",this.showInfo=!0,this.showPoints=!1,this.modal=null}handleChangeSelectedIndex(){this.selected=this.items[this.selectedIndex]}handleChangeSelected(){this.buildBgImage(this.selected.image)}handleCloseModal(){this.modal=null}setError(t){const s=[...this.error,t];this.error=s}validateFetchedData(t){t?(t.title||this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid `title`"),".")),t.info||this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid `info`"),".")),t.items&&t.items.length||this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid `items`"),"."))):this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid `config response`"),"."))}calculatePointPosition(t,s){var i,l;return{left:100/(null===(i=this.bgDimensions)||void 0===i?void 0:i.width)*t+"%",top:100/(null===(l=this.bgDimensions)||void 0===l?void 0:l.height)*s+"%"}}async buildBgImage(t){var i;if((null===(i=this.error)||void 0===i?void 0:i.length)>0)return;const l=document.createElement("img");l.classList.add("image"),l.src=t,this.imgElem.src=l.src,l.onload=()=>{this.bgDimensions={height:l.naturalHeight,width:l.naturalWidth},this.showPoints=!0},l.onerror=()=>{this.setError(s("span",null,"yduqs-virtual-map needs a ",s("strong",null,"valid `background url`"),".")),this.step="loading"}}async init(){return await fetch(this.config).then((t=>t.json())).then((t=>{var s;this.validateFetchedData(t),this.title=null==t?void 0:t.title,this.info=null==t?void 0:t.info,this.items=null==t?void 0:t.items,(null==t?void 0:t.background)&&(this.hostElem.style.backgroundImage=`url(${t.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step="info",setTimeout((()=>{this.selectedIndex=0}),500))})).catch((t=>{this.setError(s("span",null,"Fetched response is invalid:",null==t?void 0:t.toString()))}))}handleNext(){this.showPoints=!1,this.selectedIndex+=1}handlePrev(){this.showPoints=!1,this.selectedIndex-=1}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-show-points needs a ",s("strong",null,"valid attribute `config`"),".")))}handlePointClick(t){this.modal=t.content}handleStartGame(){this.showInfo=!1,this.step="game"}render(){var t,n,e,a;return s(l,{class:`c-lab-game c-show-points step-${this.step}`,ref:t=>this.hostElem=t},"loading"!==this.step?s(i,null,s("header",{class:"c-lab-game-header"}),s("div",{class:"c-lab-game-container"},s("div",{class:"c-lab-game-info "+(this.showInfo?"show":"hide")},s("div",{class:"c-lab-game-info-text",innerHTML:this.info}),"info"===this.step?s("div",{class:"btns"},s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleStartGame()},"Começar")):s("div",{class:"expand-btn"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right")))),s("div",{class:"c-lab-game-stage"},s("div",{class:"img"},s("img",{class:"selected-img",ref:t=>this.imgElem=t}),"game"===this.step&&(null===(t=this.selected)||void 0===t?void 0:t.points.map((t=>s("button",{class:"point "+(this.showPoints?"show":"hide"),onClick:()=>this.handlePointClick(t),style:this.calculatePointPosition(t.left,t.top)}))))))),s("footer",{class:"c-lab-game-footer"},s("button",{class:"c-button",onClick:()=>this.handlePrev(),disabled:"game"!==this.step||!Boolean(this.selectedIndex)},"Anterior"),this.selectedIndex+1<(null===(n=this.items)||void 0===n?void 0:n.length)?s("button",{class:"c-button",onClick:()=>this.handleNext(),disabled:"game"!==this.step},"Próxima"):s("button",{class:"c-button",onClick:()=>alert("CONCLUIR"),disabled:"game"!==this.step},"Concluir")),s("yduqs-modal",{_title:null===(e=this.modal)||void 0===e?void 0:e.title,variant:"lab",size:"large",id:`${this._id}-feedback-modal`,isopen:Boolean(this.modal)},s("div",{class:"c-lab-game-modal"},s("div",{class:"content",innerHTML:null===(a=this.modal)||void 0===a?void 0:a.text})))):s("yduqs-lab-error",{errors:this.error}))}static get watchers(){return{selectedIndex:["handleChangeSelectedIndex"],selected:["handleChangeSelected"]}}};export{n as yduqs_show_points}