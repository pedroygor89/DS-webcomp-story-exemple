import{r as t,c as i,h as s,F as n,a as e}from"./p-3b8a929f.js";const a={LOADING:"loading",INFO:"info",GAME:"game"},l=class{constructor(s){t(this,s),this.trainningEnd=i(this,"trainningEnd",7),this.error=[],this.selecteds=[],this.step=a.LOADING,this.showTip=!0,this.showInfo=!0,this.dropAttr={onDragOver:t=>this.handleDragOver(t),onDragEnter:t=>this.handleDragEnter(t),onDragLeave:t=>this.handleDragLeave(t),onDrop:t=>this.handleDrop(t)}}handleCloseFeedback(){this.feedback&&(this.feedback.isPositive||(this.showTip=!0),this.feedback.isLast&&(this.trainningEnd.emit({trainning:this._id}),this.reset()),this.feedback=null)}verify(t){return t.id===this.sequence[this.selecteds.length]}showNegativeFeedback(t){this.feedback={thumb:t.thumb,text:t.negative,isPositive:!1}}showPositiveFeedback(t){var i,s;this.feedback={thumb:t.thumb,text:t.positive,isPositive:!0,isLast:(null===(i=this.selecteds)||void 0===i?void 0:i.length)===(null===(s=this.sequence)||void 0===s?void 0:s.length)}}handleDragStart(t){this.showInfo=!1,t.dataTransfer.setData("text/plain",t.target.id)}handleDragOver(t){t.preventDefault()}handleDrop(t){var i,s,n;t.preventDefault(),this.handleDragLeave(t);const e=t.dataTransfer.getData("text"),a=null===(i=this.data)||void 0===i?void 0:i.find((t=>t.id===e));if(this.verify(a)){const t=[...this.data];t[null===(s=this.data)||void 0===s?void 0:s.findIndex((t=>t.id===e))].selected=!0,this.data=t,this.selecteds.push(null===(n=this.data)||void 0===n?void 0:n.find((t=>t.id===e))),this.showTip=!1,this.showPositiveFeedback(a)}else this.showNegativeFeedback(a);t.dataTransfer.clearData()}handleDragEnter(t){t.target.classList.add("active")}handleDragLeave(t){t.target.classList.remove("active")}setError(t){const i=[...this.error,t];this.error=i}validateFetchedData(t){t?(t.title||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `title`"),".")),t.info||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `info`"),".")),t.sequence&&t.sequence.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `sequence`"),".")),t.items&&t.items.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `items`"),".")),t.dropzone||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `dropzone`"),"."))):this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((t=>t.json())).then((t=>{var i,s;this.validateFetchedData(t),this.title=null==t?void 0:t.title,this.info=null==t?void 0:t.info,this.dropImage=null==t?void 0:t.dropzone,this.sequence=null==t?void 0:t.sequence,this.data=null===(i=t.items)||void 0===i?void 0:i.map((t=>Object.assign(Object.assign({},t),{selected:!1}))),(null==t?void 0:t.background)&&(this.hostElem.style.backgroundImage=`url(${t.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step=a.INFO)})).catch((t=>{this.setError(s("span",null,"Fetched response is invalid:",null==t?void 0:t.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `config`"),".")))}reset(){this.selecteds=[],this.step=a.loading,this.showTip=!0,this.showInfo=!0,this.init()}handleStartGame(){this.showInfo=!1,this.step=a.GAME}render(){var t,i,l,d,o,h=this.step!==a.LOADING&&this.data.find((t=>(null==t?void 0:t.id)===this.sequence[this.selecteds.length]));return s(e,{class:`c-lab-game c-ordered c-ordered-trainning step-${this.step}`,ref:t=>this.hostElem=t},this.step!==a.LOADING?s(n,null,s("header",{class:"c-lab-game-header"},s("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-count"},null===(t=this.selecteds)||void 0===t?void 0:t.length,"/",null===(i=this.sequence)||void 0===i?void 0:i.length)),s("div",{class:"c-lab-game-container"},s("div",{class:`c-lab-game-info ${this.step===a.TUTORIAL?"noIndex":""} ${this.showInfo?"show":"hide"}`},s("div",{class:"c-lab-game-info-text",innerHTML:this.info}),this.step===a.INFO?s("div",{class:"btns"},s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleStartGame()},"ComeÃ§ar")):s("div",{class:"expand-btn"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right")))),s("div",Object.assign({class:"c-lab-game-stage"},this.dropAttr),this.dropImage&&s("img",{src:this.dropImage,alt:""}),(null===(l=this.selecteds)||void 0===l?void 0:l.length)>0&&(null===(d=[...this.data])||void 0===d?void 0:d.reverse().map((t=>this.selecteds.find((i=>i.id===t.id))?s("img",{src:t.image,class:"preview",alt:""}):"")))),s("div",{class:"c-lab-game-options"},s("span",{class:"c-lab-game-tutorial-tip left-top "+(this.step!==a.INFO&&!Boolean(this.feedback)&&this.showTip?"show":"hide"),style:{marginTop:"17px"}},"Arraste o item em destaque"),s("div",{class:"c-lab-game-options-scroll"},null===(o=this.data)||void 0===o?void 0:o.map((t=>s("div",{id:t.id,class:`c-lab-game-options-item ${t.id===(null==h?void 0:h.id)?"active u-colored-pulse":""} ${Boolean(this.feedback)?"disabled":""}`,draggable:/*!item.selected &&*/!Boolean(this.feedback),onDragStart:t=>this.handleDragStart(t),style:{backgroundImage:`url(${t.thumb})`}})))))),this.feedback&&s("yduqs-modal",{size:"small",variant:"lab",isopen:!0,id:`${this._id}-feedback-modal`},s("div",{class:"c-lab-game-modal-feedback"},s("div",{class:"content"},s("yduqs-feedback-thumb",{class:"thumb",feedback:this.feedback.isPositive,image:this.feedback.thumb}),s("p",null,this.feedback.text)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},"Continuar"))))):s("yduqs-lab-error",{errors:this.error}))}};export{l as yduqs_ordered_dnd_trainning}