import{r as s,h as i,F as t,a as n}from"./p-3b8a929f.js";const l={LOADING:"loading",GAME:"game"},o=class{constructor(i){s(this,i),this.error=[],this.step=l.LOADING,this.showInfo=!0,this.modal=null}handleChangeSelected(){this.buildBgImage(this.selected.image)}handleCloseModal(){this.modal=null}setError(s){const i=[...this.error,s];this.error=i}validateFetchedData(s){s?(s.title||this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid `title`"),".")),s.info||this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid `info`"),".")),s.items&&s.items.length||this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid `items`"),"."))):this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid `config response`"),"."))}calculatePointPosition(s,i){var t,n;return{left:100/(null===(t=this.bgDimensions)||void 0===t?void 0:t.width)*s+"%",top:100/(null===(n=this.bgDimensions)||void 0===n?void 0:n.height)*i+"%"}}async buildBgImage(s){var t;if((null===(t=this.error)||void 0===t?void 0:t.length)>0)return;const n=document.createElement("img");n.classList.add("image"),n.src=s,this.imgElem.innerHTML="",this.imgElem.appendChild(n),n.onload=()=>{this.bgDimensions={height:n.naturalHeight,width:n.naturalWidth}},n.onerror=()=>{this.setError(i("span",null,"yduqs-virtual-map needs a ",i("strong",null,"valid `background url`"),".")),this.step=l.LOADING}}async init(){return await fetch(this.config).then((s=>s.json())).then((s=>{var i;this.validateFetchedData(s),this.title=null==s?void 0:s.title,this.info=null==s?void 0:s.info,this.items=null==s?void 0:s.items,(null==s?void 0:s.background)&&(this.hostElem.style.backgroundImage=`url(${s.background})`),(null===(i=this.error)||void 0===i?void 0:i.length)||(this.step=l.GAME,setTimeout((()=>{this.selected=this.items[0]}),500))})).catch((s=>{this.setError(i("span",null,"Fetched response is invalid:",null==s?void 0:s.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid attribute `id`"),".")),this.config||this.setError(i("span",null,"yduqs-show-points needs a ",i("strong",null,"valid attribute `config`"),".")))}handlePointClick(s){this.modal=s.content}render(){var s,o,e,a;return i(n,{class:"c-show-points",ref:s=>this.hostElem=s},this.step!==l.LOADING?i(t,null,i("header",{class:"c-show-points-header"},i("h2",{class:"c-show-points-header-title"},this.title)),i("div",{class:"c-show-points-container"},i("div",{class:"c-ordered-container-info "+(this.step===l.TUTORIAL?"noIndex":this.showInfo?"show":"hide")},i("div",{class:"c-show-points-container-info-container"},i("div",{class:"c-show-points-container-info-text"},i("div",{class:"desc"},i("p",null,this.info))),i("div",{class:"c-ordered-container-info-control"},i("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},i("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right"))))),i("div",{class:"c-show-points-container-stage"},i("div",{class:"img"},i("div",{ref:s=>this.imgElem=s}),null===(s=this.selected)||void 0===s?void 0:s.points.map((s=>i("button",{class:"point",onClick:()=>this.handlePointClick(s),style:this.calculatePointPosition(s.left,s.top)})))))),i("yduqs-modal",{_title:null===(o=this.modal)||void 0===o?void 0:o.title,variant:"lab",size:"large",id:`${this._id}-feedback-modal`,isopen:Boolean(this.modal)},i("div",{class:"c-show-points-modal"},i("div",{class:"content",innerHTML:null===(e=this.modal)||void 0===e?void 0:e.text})))):i(t,null,"Loading...",(null===(a=this.error)||void 0===a?void 0:a.length)>0&&i("dl",null,i("dt",null,"Errors"),this.error.map((s=>i("dd",null,s))))))}static get watchers(){return{selected:["handleChangeSelected"]}}};export{o as yduqs_show_points}