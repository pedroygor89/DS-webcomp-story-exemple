import{r as i,c as t,h as s,F as n,a as e}from"./p-3b8a929f.js";const a={LOADING:"loading",INFO:"info",GAME:"game"},l=class{constructor(s){i(this,s),this.trainningEnd=t(this,"trainningEnd",7),this.error=[],this.selecteds=[],this.step=a.LOADING,this.showTip=!0,this.showInfo=!0,this.dropAttr={onDragOver:i=>this.handleDragOver(i),onDragEnter:i=>this.handleDragEnter(i),onDragLeave:i=>this.handleDragLeave(i),onDrop:i=>this.handleDrop(i)}}handleCloseFeedback(){this.feedback&&(this.feedback.isPositive||(this.showTip=!0),this.feedback.isLast&&(this.trainningEnd.emit({trainning:this._id}),this.reset()),this.feedback=null)}verify(i){return i.id===this.sequence[this.selecteds.length]}showNegativeFeedback(i){this.feedback={thumb:i.thumb,text:i.negative,isPositive:!1}}showPositiveFeedback(i){var t,s;this.feedback={thumb:i.thumb,text:i.positive,isPositive:!0,isLast:(null===(t=this.selecteds)||void 0===t?void 0:t.length)===(null===(s=this.sequence)||void 0===s?void 0:s.length)}}handleDragStart(i){this.showInfo=!1,i.dataTransfer.setData("text/plain",i.target.id)}handleDragOver(i){i.preventDefault()}handleDrop(i){var t,s,n;i.preventDefault(),this.handleDragLeave(i);const e=i.dataTransfer.getData("text"),a=null===(t=this.data)||void 0===t?void 0:t.find((i=>i.id===e));if(this.verify(a)){const i=[...this.data];i[null===(s=this.data)||void 0===s?void 0:s.findIndex((i=>i.id===e))].selected=!0,this.data=i,this.selecteds.push(null===(n=this.data)||void 0===n?void 0:n.find((i=>i.id===e))),this.showTip=!1,this.showPositiveFeedback(a)}else this.showNegativeFeedback(a);i.dataTransfer.clearData()}handleDragEnter(i){i.target.classList.add("active")}handleDragLeave(i){i.target.classList.remove("active")}setError(i){const t=[...this.error,i];this.error=t}validateFetchedData(i){i?(i.title||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `title`"),".")),i.info||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `info`"),".")),i.sequence&&i.sequence.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `sequence`"),".")),i.items&&i.items.length||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `items`"),".")),i.dropzone||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `dropzone`"),"."))):this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((i=>i.json())).then((i=>{var t,s;this.validateFetchedData(i),this.title=null==i?void 0:i.title,this.info=null==i?void 0:i.info,this.dropImage=null==i?void 0:i.dropzone,this.sequence=null==i?void 0:i.sequence,this.data=null===(t=i.items)||void 0===t?void 0:t.map((i=>Object.assign(Object.assign({},i),{selected:!1}))),(null==i?void 0:i.background)&&(this.hostElem.style.backgroundImage=`url(${i.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step=a.INFO)})).catch((i=>{this.setError(s("span",null,"Fetched response is invalid:",null==i?void 0:i.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-ordered-dnd-trainning needs a ",s("strong",null,"valid attribute `config`"),".")))}reset(){this.selecteds=[],this.step=a.loading,this.showTip=!0,this.showInfo=!0,this.init()}handleStartGame(){this.showInfo=!1,this.step=a.GAME}render(){var i,t,l,d,o,h=this.step!==a.LOADING&&this.data.find((i=>(null==i?void 0:i.id)===this.sequence[this.selecteds.length]));return s(e,{class:`c-lab-game c-ordered c-ordered-trainning step-${this.step}`,ref:i=>this.hostElem=i},this.step!==a.LOADING?s(n,null,s("header",{class:"c-lab-game-header"},s("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-count"},null===(i=this.selecteds)||void 0===i?void 0:i.length,"/",null===(t=this.sequence)||void 0===t?void 0:t.length)),s("div",{class:"c-lab-game-container"},s("div",{class:`c-lab-game-info ${this.step===a.TUTORIAL?"noIndex":""} ${this.showInfo?"show":"hide"}`},s("div",{class:"c-lab-game-info-text",innerHTML:this.info}),this.step===a.INFO?s("div",{class:"btns"},s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleStartGame()},"ComeÃ§ar")):s("div",{class:"expand-btn"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right")))),s("div",Object.assign({class:"c-lab-game-stage"},this.dropAttr),this.dropImage&&s("img",{src:this.dropImage,alt:""}),(null===(l=this.selecteds)||void 0===l?void 0:l.length)>0&&(null===(d=[...this.data])||void 0===d?void 0:d.reverse().map((i=>this.selecteds.find((t=>t.id===i.id))?s("img",{src:i.image,class:"preview",alt:""}):"")))),s("div",{class:"c-lab-game-options"},s("span",{class:"c-lab-game-tutorial-tip left-top "+(this.step!==a.INFO&&!Boolean(this.feedback)&&this.showTip?"show":"hide"),style:{marginTop:"17px"}},"Arraste o item em destaque"),s("div",{class:"c-lab-game-options-scroll"},null===(o=this.data)||void 0===o?void 0:o.map((i=>s("div",{id:i.id,class:`c-lab-game-options-item ${i.id===(null==h?void 0:h.id)?"active u-colored-pulse":""} ${Boolean(this.feedback)?"disabled":""}`,draggable:/*!item.selected &&*/!Boolean(this.feedback),onDragStart:i=>this.handleDragStart(i),style:{backgroundImage:`url(${i.thumb})`}})))))),this.feedback&&s("yduqs-modal",{size:"small",variant:"lab",isopen:!0,id:`${this._id}-feedback-modal`},s("div",{class:"c-lab-game-modal-feedback"},s("div",{class:"content"},s("div",{class:"thumb"},s("img",{class:"image",src:this.feedback.thumb,alt:""}),s("span",{class:"material-icons badge "+(this.feedback.isPositive?"success":"error")},this.feedback.isPositive?"check_circle":"cancel")),s("p",null,this.feedback.text)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},"Continuar"))))):s("yduqs-lab-error",{errors:this.error}))}};export{l as yduqs_ordered_dnd_trainning}