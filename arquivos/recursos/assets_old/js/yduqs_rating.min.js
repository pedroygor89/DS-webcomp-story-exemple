var yduqs_rating = $(".c-module-rating"); yduqs_rating.each(function (o) { var a = $(this).closest("module").attr("id"); a = a.match(/\d+/)[0], $(this).addClass("feedback_modulo" + a + " "), starBlock = $(this).find(".star-rating"), starLabels = starBlock.find("label"), $(starLabels.get().reverse()).each(function (o) { $(this).attr("id", "mod" + a + "_nota" + (o + 1)), $(window).width() >= 768 ? $(this).attr("onclick", `rate_mod('${a}-${o + 1}');`) : $(this).attr("onclick", `avaliarModuloMobile('${a}-${o + 1}');`) }), $(this).closest("yduqs-module-rating").attr("module", a), $(this).find(".c-module-rating__button-container button").addClass("btn_mod" + a), $(this).find(".c-module-rating__button-container button").attr("onclick", "avaliarModulo('')"), $(this).find(".c-module-rating__icon-box").attr("onclick", "closeRating('')") }), window.onresize = function () { yduqs_rating.each(function (o) { var a = $(this).closest("module").attr("id"); a = a.match(/\d+/)[0], $(this).addClass("feedback_modulo" + a + " "), starBlock = $(this).find(".star-rating"), starLabels = starBlock.find("label"), $(starLabels.get().reverse()).each(function (o) { $(this).attr("id", "mod" + a + "_nota" + (o + 1)), $(window).width() >= 768 ? $(this).attr("onclick", `rate_mod('${a}-${o + 1}');`) : $(this).attr("onclick", `avaliarModuloMobile('${a}-${o + 1}');`) }), $(this).closest("yduqs-module-rating").attr("module", a), $(this).find(".c-module-rating__button-container button").addClass("btn_mod" + a), $(this).find(".c-module-rating__button-container button").attr("onclick", "avaliarModulo('')"), $(this).find(".c-module-rating__icon-box").attr("onclick", "closeRating('')") }) }; var numeroDeModulos = $('module[id*="modulo"]').length; for (m = 1; m <= numeroDeModulos; m++)window["mod" + m + "nota"] = 0; function rate_mod(o) { $(".c-module-rating__button-container button").removeAttr("disabled"), o = o.split(/\s*\-\s*/g), modulo = o[0], nota = o[1]; let a = $(".feedback_modulo" + modulo).find(".star-rating"); $(".btn_mod" + modulo).attr("onclick", `avaliarModulo('${modulo}-${nota}')`), mod_star_label = a.find("label"), star_empty = ');"><i class="active material-icons large" aria-hidden="true">star</i></label>', star_full = ');"><i class="active material-icons large gold-star" aria-hidden="true">star</i></label>', 1 == nota && (mod_star_label.each(function (o) { a.html(`\n                <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_empty}\n                <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_empty}\n                <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n            `) }), window["mod" + modulo + "nota"] = nota), 2 == nota && (mod_star_label.each(function (o) { a.html(`\n                <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_empty}\n                <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n            `) }), window["mod" + modulo + "nota"] = nota), 3 == nota && (mod_star_label.each(function (o) { a.html(`\n                <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n            `) }), window["mod" + modulo + "nota"] = nota), 4 == nota && (mod_star_label.each(function (o) { a.html(`\n                <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_full}\n                <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n            `) }), window["mod" + modulo + "nota"] = nota), 5 == nota && (mod_star_label.each(function (o) { a.html(`\n                <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_full}\n                <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_full}\n                <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n            `) }), window["mod" + modulo + "nota"] = nota) } function avaliarModuloMobile(o) { if (o = o.split(/\s*\-\s*/g), modulo = o[0], nota = o[1], "" == o) alert("escolha uma nota para o módulo"); else { let o = $(".feedback_modulo" + modulo).find(".star-rating"), a = $(".btn_mod" + modulo); a.attr("disabled", "true"), mod_star_label = o.find("label"), star_empty = ');"><i class="active material-icons large" aria-hidden="true">star</i></label>', star_full = ');"><i class="active material-icons large gold-star" aria-hidden="true">star</i></label>', 1 == nota && (mod_star_label.each(function (a) { o.html(`\n                    <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                    <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                    <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_empty}\n                    <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_empty}\n                    <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n                `) }), window["mod" + modulo + "nota"] = nota), 2 == nota && (mod_star_label.each(function (a) { o.html(`\n                    <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                    <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                    <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_empty}\n                    <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                    <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n                `) }), window["mod" + modulo + "nota"] = nota), 3 == nota && (mod_star_label.each(function (a) { o.html(`\n                    <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                    <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_empty}\n                    <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                    <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                    <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n                `) }), window["mod" + modulo + "nota"] = nota), 4 == nota && (mod_star_label.each(function (a) { o.html(`\n                    <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_empty}\n                    <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_full}\n                    <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                    <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                    <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n                `) }), window["mod" + modulo + "nota"] = nota), 5 == nota && (mod_star_label.each(function (a) { o.html(`\n                    <label id="mod${modulo}_nota5" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-5'${star_full}\n                    <label id="mod${modulo}_nota4" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-4'${star_full}\n                    <label id="mod${modulo}_nota3" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-3'${star_full}\n                    <label id="mod${modulo}_nota2" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-2'${star_full}\n                    <label id="mod${modulo}_nota1" style="display: inline-block;margin-left: -3px;" onclick="rate_mod('${modulo}-1'${star_full}\n                `) }), window["mod" + modulo + "nota"] = nota), block_stars = a.closest(".feedback_modulo" + modulo), disable_stars = block_stars.find(".star-rating"), disable_stars_labels = disable_stars.find("label"), disable_stars_labels.each(function (o) { $(this).removeAttr("onclick") }), closeFeedback = $("#mod" + modulo + "_nota" + nota).closest(".c-rating"), closeFeedback.removeClass("avaliar"), closeFeedback.addClass("avaliado"), closeFeedback.attr("disabled", ""), msgFeedback = closeFeedback.find("h3"), msgFeedback.text("Recebemos sua avaliação!"), $("#avaliacaoTema").attr("nota-mod" + modulo, nota), swapStars = closeFeedback.find(".star-rating"), notaY = '<label><i class="active material-icons large gold-star" aria-hidden="true">star</i></label>', notaN = '<label><i class="active material-icons large" aria-hidden="true">star</i></label>', nota1 = notaN.repeat(4) + notaY, nota2 = notaN.repeat(3) + notaY.repeat(2), nota3 = notaN.repeat(2) + notaY.repeat(3), nota4 = notaN + notaY.repeat(4), nota5 = notaY.repeat(5), notaFinal = parseInt(window.mod1nota) + parseInt(window.mod2nota) + parseInt(window.mod3nota) + parseInt(window.mod4nota), notaFinal /= numeroDeModulos, notaFinal = Math.ceil(notaFinal), modsAvaliados = $(".avaliado").length, modsAvaliados == numeroDeModulos && (notaTema = $("#avaliacaoTema").find(".star-rating"), $("#avaliacaoTema").removeClass("d-none"), $("#avaliacaoTema").attr("nota-tema", notaFinal), 1 == notaFinal ? notaTema.html(nota1) : 2 == notaFinal ? notaTema.html(nota2) : 3 == notaFinal ? notaTema.html(nota3) : 4 == notaFinal ? notaTema.html(nota4) : 5 == notaFinal && notaTema.html(nota5)) } $(`.c-module-rating__button-container .btn_mod${modulo}`).addClass("d-none"), setTimeout(function () { $(".c-module-rating").removeClass("open-rating") }, 1e3), setTimeout(function () { $(".c-module-rating").addClass("d-none") }, 2e3) } function avaliarModulo(o) { console.log("avaliando..."), o = o.split(/\s*\-\s*/g), modulo = o[0], nota = o[1], closeFeedback = $("#mod" + modulo + "_nota" + nota).closest(".c-rating"), closeFeedback.removeClass("avaliar"), closeFeedback.addClass("avaliado"), closeFeedback.attr("disabled", ""), msgFeedback = closeFeedback.find("h3"), msgFeedback.text("Recebemos sua avaliação !"), $("#avaliacaoTema").attr("nota-mod" + modulo, nota), swapStars = closeFeedback.find(".star-rating"), notaY = '<label><i class="active material-icons large gold-star" aria-hidden="true">star</i></label>', notaN = '<label><i class="active material-icons large" aria-hidden="true">star</i></label>', nota1 = notaN.repeat(4) + notaY, nota2 = notaN.repeat(3) + notaY.repeat(2), nota3 = notaN.repeat(2) + notaY.repeat(3), nota4 = notaN + notaY.repeat(4), nota5 = notaY.repeat(5), 1 == nota ? (swapStars.html(nota1), window["mod" + modulo + "nota"] = nota) : 2 == nota ? (swapStars.html(nota2), window["mod" + modulo + "nota"] = nota) : 3 == nota ? (swapStars.html(nota3), window["mod" + modulo + "nota"] = nota) : 4 == nota ? (swapStars.html(nota4), window["mod" + modulo + "nota"] = nota) : 5 == nota && (swapStars.html(nota5), window["mod" + modulo + "nota"] = nota), notaFinal = parseInt(window.mod1nota) + parseInt(window.mod2nota) + parseInt(window.mod3nota) + parseInt(window.mod4nota), notaFinal /= numeroDeModulos, notaFinal = Math.ceil(notaFinal), modsAvaliados = $(".avaliado").length, modsAvaliados == numeroDeModulos && (notaTema = $("#avaliacaoTema").find(".star-rating"), $("#avaliacaoTema").removeClass("d-none"), $("#avaliacaoTema").removeClass("d-none"), $("#avaliacaoTema").attr("nota-tema", notaFinal), 1 == notaFinal ? notaTema.html(nota1) : 2 == notaFinal ? notaTema.html(nota2) : 3 == notaFinal ? notaTema.html(nota3) : 4 == notaFinal ? notaTema.html(nota4) : 5 == notaFinal && notaTema.html(nota5)), $(`.c-module-rating__button-container .btn_mod${modulo}`).addClass("d-none"), setTimeout(function () { $(".c-module-rating").removeClass("open-rating") }, 1e3), setTimeout(function () { $(".c-module-rating").addClass("d-none") }, 2e3) } function closeRating() { yduqs_rating.removeClass("open-rating"), setTimeout(function () { yduqs_rating.addClass("d-none") }, 1e3) } $("module#conclusao").after('\n<yduqs-section>\n    <div id="avaliacaoTema" class="temaFeedback d-none">\n        <h3 class="text-center py-5">Avaliação do tema:</h3>\n        <div class="star-rating"></div>\n    </div>\n</yduqs-section>\n'), window.mod1nota = "0", window.mod2nota = "0", window.mod3nota = "0", window.mod4nota = "0";