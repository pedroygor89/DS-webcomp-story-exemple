import{r as t,h as s,a as i}from"./p-6197c452.js";const e=(t,s)=>{window.dispatchEvent(new CustomEvent(t,s?{detail:s}:null))},a={apresentacao:"Apresentação",atividade:"Atividade",conclusao:"Conclusão"},r=["#comment","#text","SCRIPT","STYLE","IFRAME","HR","svg","path","g","math","mi","mo","mrow","mfrac","msqrt","msup","mn"];let n=class{constructor(s){t(this,s),this.open=!1,this.term="",this.hasSearch=!1,this.actualFoundItemPosition=-1,this.cacheDbId="data-cache-id",this.termFoundClass="c-search-found-item",this.termFoundResultClass="c-search-found-result-item"}reset(){var t,s;(null===(t=this.term)||void 0===t?void 0:t.length)?(null===(s=this.term)||void 0===s?void 0:s.length)>2&&this.handleSubmit({}):(this.hasSearch=!1,this.clearResults())}removeDoubleSpacesAndBreaks(t){if(!t)return t;let s=t;return s=s.replace(/[\n]/giu," "),s=s.replace(/[\r]/giu," "),s=s.replace(/  +/g," "),s}cleanString(t){if(!t)return t;let s=t.toLowerCase();return s=s.replace(/[áàãâä]/giu,"a"),s=s.replace(/[éèêë]/giu,"e"),s=s.replace(/[íìîï]/giu,"i"),s=s.replace(/[óòõôö]/giu,"o"),s=s.replace(/[úùûü]/giu,"u"),s=s.replace(/[ç]/giu,"c"),s=s.replace(/[ñ]/giu,"n"),this.removeDoubleSpacesAndBreaks(s)}createCachedDb(){const t=$("p.c-paragraph, span:not(.material-icons,.c-video-player__cover-title), strong, i:not(.material-icons), em, h1, h2, h3, h4, h5, h6, li, dt, dd, a:not(.c-button)");for(let s=0;s<t.length;s++)r.includes(t[s].nodeName)||"MJX-"==t[s].nodeName.substring(0,4)||Boolean($(t[s]).parents("yduqs-menu, yduqs-rating, yduqs-modal").length)||$(t[s]).attr(this.cacheDbId,(Math.random()+1).toString(36).substring(2));const s=$(`body *[${this.cacheDbId}]`),i=[];for(let t=0;t<s.length;t++){$(s[t]).html(this.removeDoubleSpacesAndBreaks($(s[t]).html()));const e=$(s[t]),a=e.clone().contents(),r=a.map((t=>{var s;return"#text"===a[t].nodeName?this.cleanString(a[t].textContent):(null===(s=a[t].dataset)||void 0===s?void 0:s.cacheId)?Array.from(Array(a[t].outerHTML.length),(()=>"*")).join(""):void 0}));if(r.length>0){const t={cachedId:e.attr(this.cacheDbId),original:e.html(),parsed:Array.from(r).join("")};i.push(t)}}return i}findInDocument(){this.actualFoundItemPosition=-1;let t=this.cleanString(this.term);if(this.clearResults(),this.hasSearch=!0,""===t)return;const s=this.cachedDb.map((s=>({cachedId:s.cachedId,index:s.parsed.indexOf(t),length:t.length}))).filter((t=>t.index>=0));let i=[];s.forEach(((t,s)=>{var e,r,n,c,o;const h=$(`body *[${this.cacheDbId}="${t.cachedId}"]`),l=null===(e=h.html())||void 0===e?void 0:e.substr(t.index,t.length),u=null===(r=h.closest("[data-page]"))||void 0===r?void 0:r.attr("data-page"),d=null===(n=h.closest("[data-module]"))||void 0===n?void 0:n.attr("data-module"),v=d?isNaN(Number(d))?a[d]||"":`Módulo ${d}`:"",m=null===(c=h.html())||void 0===c?void 0:c.substr(0,t.index),p=t=>`<span class="${t}">${l}</span>`,b=null===(o=h.html())||void 0===o?void 0:o.substr(t.index+l.length);h.html(m+p(this.termFoundClass)+b),i.push({index:s,page:u||"0",locator:v,html:m+p(this.termFoundResultClass)+b})})),this.setResult(i),e("yduqs-search-called",{term:t})}setOpen(t){this.open=t}setTerm(t){this.term=t}handleOpen(){this.setOpen(!0),this.elemInput.focus()}handleClose(){this.setOpen(!1)}clearResults(){var t;this.result=[],this.hasSearch=!1;const s=$(`.${this.termFoundClass}`);for(let e=0;e<s.length;e++)if($(s[e]).is("span")){const a=$(s[e]).parent();var i=null===(t=this.cachedDb.find((t=>t.cachedId===a.attr(this.cacheDbId))))||void 0===t?void 0:t.original;i&&$(a).html(i)}e("yduqs-search-cleaned")}handleClear(){this.setTerm(""),this.clearResults()}handleReset(){this.handleClear(),this.handleClose()}handleInputChange(t){this.setTerm(t.target.value)}setResult(t){this.result=t}navigateOnResults(t){var s=$(`body span.${this.termFoundClass}`);if(this.actualFoundItemPosition=t<0?s.length-1:t>=s.length?0:t,s.eq(this.actualFoundItemPosition)){let t=s.eq(this.actualFoundItemPosition).offset().top;$(window).scrollTop(t-120)}this.handleClose(),e("yduqs-search-navigate",{position:this.actualFoundItemPosition})}handleResultItemClick(t,s){e("yduqs-search-before-navigate",{position:t,page:s}),setTimeout((()=>{this.navigateOnResults(t)}),400)}handleSubmit(t){"submit"===t.type&&t.preventDefault(),this.open?(this.cachedDb||(this.cachedDb=this.createCachedDb()),this.findInDocument()):this.handleOpen()}render(){var t;return s(i,{class:"c-search-bar"},s("form",{class:"c-search-bar-trigger "+(this.open?"opened":""),onSubmit:t=>this.handleSubmit(t)},s("button",{type:"button",class:"c-button c-button__icon-container u-text--small c-search-bar-trigger-back",onClick:()=>this.handleReset()},s("span",{class:"c-button__icon material-icons"},"arrow_back")),s("div",{class:"c-search-bar-trigger-input-container"},s("input",{type:"search",class:"c-search-bar-trigger-input",onInput:t=>this.handleInputChange(t),value:this.term,ref:t=>this.elemInput=t,placeholder:"Pesquisar no tema"}),this.hasSearch&&s("span",{class:"c-button__icon material-icons",onClick:()=>this.handleClear()},"close")),s("button",{type:"submit",class:"c-button c-button__icon-container u-text--small c-search-bar-trigger-btn"},s("span",{class:"c-button__icon material-icons"},"search"))),s("div",{class:"c-search-bar-result "+(this.open?"opened":"")},s("div",{class:"c-search-bar-result-overlay",onClick:()=>this.handleClose()}),s("div",{class:"c-search-bar-result-container"},(null===(t=this.result)||void 0===t?void 0:t.length)>0?s("div",{class:"c-search-bar-result-list"},this.result.map((t=>s("div",{class:"c-search-bar-result-list-item",onClick:()=>this.handleResultItemClick(t.index,t.page)},s("div",{class:"item-breadcrumb"},t.locator),s("div",{innerHTML:t.html}))))):this.hasSearch?s("div",{class:"c-search-bar-result-list-empty"},"Não encontramos nenhum resultado"):s("div",null))))}static get watchers(){return{term:["reset"]}}};export{n as yduqs_search_bar}