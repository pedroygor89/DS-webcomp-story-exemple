import{r as s,c as t,h as i,F as e,a}from"./p-3b8a929f.js";const l={LOADING:"loading",INFO:"info",GAME:"game"},h=class{constructor(i){s(this,i),this.challengeEnd=t(this,"challengeEnd",7),this.error=[],this.step=l.LOADING,this.showInfo=!0,this.usedChances=0,this.stageAttr={onMouseMove:s=>this.getPos(s),onMouseLeave:()=>this.handleCursorLeave(),onTouchStart:s=>this.getPos(s),onTouchMove:s=>this.getPos(s),onTouchEnd:()=>this.handleCursorLeave()}}handleGameOver(){this.gameover()}setError(s){const t=[...this.error,s];this.error=t}validateFetchedData(s){s?(s.info||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `info`"),".")),s.items&&s.items.length||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `items`"),"."))):this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((s=>s.json())).then((s=>{var t;this.validateFetchedData(s),this.info=null==s?void 0:s.info,this.items=null==s?void 0:s.items,this.chances=(null==s?void 0:s.chances)||3,this.positiveBtnText=(null==s?void 0:s.positiveBtnText)||"Aprovar",this.negativeBtnText=(null==s?void 0:s.negativeBtnText)||"Reprovar",(null==s?void 0:s.background)&&(this.hostElem.style.backgroundImage=`url(${s.background})`),this.selected=this.items[0],(null===(t=this.error)||void 0===t?void 0:t.length)||(this.step=l.INFO)})).catch((s=>{this.setError(i("span",null,"Fetched response is invalid:",null==s?void 0:s.toString()))}))}async gameover(){return this.usedChances=0,this.reset(),this.step=l.INFO,Promise.resolve()}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid attribute `id`"),".")),this.config||this.setError(i("span",null,"yduqs-zoom-challenge needs a ",i("strong",null,"valid attribute `config`"),".")))}getPos(s){if(s.preventDefault(),this.step!==l.GAME)return;let t,i,e,a;this.showInfo=!1;const h=s.target.getBoundingClientRect();if("touchstart"==s.type||"touchmove"==s.type||"touchend"==s.type||"touchcancel"==s.type){const e=(s.originalEvent||s).touches[0]||(s.originalEvent||s).changedTouches[0];t=e.pageX-h.left,i=e.pageY-h.top}else"mousedown"!=s.type&&"mouseup"!=s.type&&"mousemove"!=s.type&&"mouseover"!=s.type&&"mouseout"!=s.type&&"mouseenter"!=s.type&&"mouseleave"!=s.type||(t=s.clientX-h.left,i=s.clientY-h.top);e=t-this.displayElem.clientWidth/2,a=i-this.displayElem.clientHeight-20;const o=this.displayImg.clientWidth/this.stageElem.clientWidth*t-this.displayElem.clientWidth/2,n=this.displayImg.clientHeight/this.stageElem.clientHeight*i-this.displayElem.clientHeight/2;this.displayImg.style.left=`${o>0?-Math.abs(o):Math.abs(o)}px`,this.displayImg.style.top=`${n>0?-Math.abs(n):Math.abs(n)}px`,e+this.displayElem.clientWidth>this.stageElem.clientWidth&&(e=e-(e+this.displayElem.clientWidth-this.stageElem.clientWidth)-5),a+h.top<0&&(a=i+20),this.displayElem.style.opacity="1",this.displayElem.style.left=`${e}px`,this.displayElem.style.top=`${a}px`}next(s){const t=[...this.sequence||[]];t.push(s),this.sequence=t,this.items.length>this.sequence.length?this.selected=this.items[this.sequence.length]:(this.step=l.FEEDBACK,this.feedback=this.sequence.every(((s,t)=>s===this.items[t].approved))?{text:"Texto do Feedback POSITIVO",isPositive:!0}:{text:"Texto do Feedback NEGATIVO",isPositive:!1})}handleCloseFeedback(){var s;this.showInfo=!0,this.step===l.FEEDBACK&&((null===(s=this.feedback)||void 0===s?void 0:s.isPositive)?(this.challengeEnd.emit({challenge:this._id,result:!0}),this.usedChances=0,this.reset()):(this.usedChances+=1,this.usedChances===this.chances?(this.challengeEnd.emit({challenge:this._id,result:!1}),this.gameover()):this.reset()))}reset(){this.showInfo=!0,this.sequence=[],this.selected=this.items[0],this.step=l.GAME}handleCursorLeave(){this.step===l.GAME&&(this.showInfo=!0,this.displayElem.style.opacity="0")}handleStartGame(){this.showInfo=!0,this.step=l.GAME}render(){var s,t;return i(a,{class:`c-lab-game c-zoom c-zoom-challenge step-${this.step}`,ref:s=>this.hostElem=s},this.step!==l.LOADING?i(e,null,i("header",{class:"c-lab-game-header"},i("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-chances"},[...Array(this.chances)].map(((s,t)=>(s||!s)&&t<this.chances-this.usedChances?i("i",{class:"material-icons active"},"favorite"):i("i",{class:"material-icons"},"favorite_border"))))),i("div",{class:"c-lab-game-container"},i("div",{class:"c-lab-game-info "+(this.showInfo?"show":"hide")},this.step===l.INFO?i(e,null,i("div",{class:"c-lab-game-info-text",innerHTML:this.info}),i("div",{class:"btns"},i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleStartGame()},"ComeÃ§ar"))):i(e,null,i("div",{class:"c-lab-game-info-text"},i("p",null,this.selected.text)),i("div",{class:"btns"},i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.next(!0)},i("i",{class:"material-icons"},"check"),this.positiveBtnText),i("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.next(!1)},i("i",{class:"material-icons"},"close"),this.negativeBtnText)),i("div",{class:"expand-btn"},i("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},i("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right"))))),i("div",{class:"c-lab-game-stage"},i("div",Object.assign({class:"img",ref:s=>this.stageElem=s},this.stageAttr),i("img",{src:this.selected.thumb,alt:""}),this.step===l.GAME&&i("div",{class:"c-lab-game-stage-preview",ref:s=>this.displayElem=s},i("img",{src:this.selected.image,alt:"",ref:s=>this.displayImg=s}))))),this.step===l.FEEDBACK&&i("yduqs-modal",{variant:"lab",size:"small",id:`${this._id}-feedback-modal`,isopen:!0},i("div",{class:"c-lab-game-modal-feedback"},i("div",{class:"content"},i("p",null,null===(s=this.feedback)||void 0===s?void 0:s.text)),!(null===(t=this.feedback)||void 0===t?void 0:t.isPositive)&&i("div",{class:"result"},this.sequence.map(((s,t)=>{var e,a;return i("div",{class:"item"},i("img",{src:null===(e=this.items[t])||void 0===e?void 0:e.image,alt:""}),s===(null===(a=this.items[t])||void 0===a?void 0:a.approved)?i("i",{class:"material-icons icon success"},"sentiment_very_satisfied"):i("i",{class:"material-icons icon error"},"sentiment_dissatisfied"))}))),i("footer",null,i("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},this.feedback.isPositive?"Continuar":this.usedChances+1===this.chances?"Voltar para Teoria":"Tentar outra vez"))))):i("yduqs-lab-error",{errors:this.error}))}};export{h as yduqs_zoom_challenge}