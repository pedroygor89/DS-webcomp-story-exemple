import{r as t,h as s,a}from"./p-c4393f38.js";import{r as i,c as e,i as r,d as o}from"./p-900da203.js";const n=["#comment","#text","SCRIPT","STYLE","IFRAME","HR","svg","path","g","math","mi","mo","mrow","mfrac","msqrt","msup","mn"],c=["yduqs-menu","yduqs-rating","yduqs-modal","yduqs-pager"].join(","),h=class{constructor(s){t(this,s),this.open=!1,this.term="",this.hasSearch=!1,this.actualFoundItemPosition=-1,this.cacheDbId="data-cache-id",this.termFoundClass="c-search-found-item",this.termFoundResultClass="c-search-found-result-item"}reset(){var t,s;(null===(t=this.term)||void 0===t?void 0:t.length)?(null===(s=this.term)||void 0===s?void 0:s.length)>2&&this.handleSubmit({}):(this.hasSearch=!1,this.clearResults())}createCachedDb(){const t=$('p, span:not(.material-icons,.c-video-player__cover-title), strong, b, u, i:not(.material-icons), em, h1, h2, h3, h4, h5, h6, li, dt, dd, a:not(.c-button), [slot="card-heading"], [slot="card-subheading"], td, th');for(let s=0;s<t.length;s++)n.includes(t[s].nodeName)||"MJX-"==t[s].nodeName.substring(0,4)||Boolean($(t[s]).parents(c).length)||$(t[s]).attr(this.cacheDbId,(Math.random()+1).toString(36).substring(2));const s=$(`body *[${this.cacheDbId}]`),a=[];for(let t=0;t<s.length;t++){$(s[t]).html(i($(s[t]).html()));const r=$(s[t]),o=r.clone().contents(),n=o.map((t=>{var s;return"#text"===o[t].nodeName?e(o[t].textContent):(null===(s=o[t].dataset)||void 0===s?void 0:s.cacheId)?Array.from(Array(o[t].outerHTML.length),(()=>"*")).join(""):void 0}));if(n.length>0){const t={cachedId:r.attr(this.cacheDbId),original:r.html(),parsed:Array.from(n).join("")};a.push(t)}}return a}findInDocument(){this.actualFoundItemPosition=-1;let t=e(this.term);if(this.clearResults(),this.hasSearch=!0,""===t)return;const s=this.cachedDb.map((s=>({cachedId:s.cachedId,index:s.parsed.indexOf(t),length:t.length}))).filter((t=>t.index>=0));let a=[];s.forEach(((t,s)=>{var i,e,o,n,c;const h=$(`body *[${this.cacheDbId}="${t.cachedId}"]`),l=null===(i=h.html())||void 0===i?void 0:i.substr(t.index,t.length),d=null===(e=h.closest("[data-page]"))||void 0===e?void 0:e.attr("data-page"),u=null===(o=h.closest("[data-module]"))||void 0===o?void 0:o.attr("data-module"),m=u?isNaN(Number(u))?r(`pager.${u}`)||"":`${r("pager.modulo")} ${u}`:"",v=null===(n=h.html())||void 0===n?void 0:n.substr(0,t.index),b=t=>`<span class="${t}">${l}</span>`,p=null===(c=h.html())||void 0===c?void 0:c.substr(t.index+l.length);h.html(v+b(this.termFoundClass)+p),a.push({index:s,page:d||"0",locator:m,html:v+b(this.termFoundResultClass)+p})})),this.setResult(a),o("yduqs-search-called",{term:t})}setOpen(t){this.open=t}setTerm(t){this.term=t}handleOpen(){this.setOpen(!0),this.elemInput.focus()}handleClose(){this.setOpen(!1)}clearResults(){var t;this.result=[],this.hasSearch=!1;const s=$(`.${this.termFoundClass}`);for(let i=0;i<s.length;i++)if($(s[i]).is("span")){const e=$(s[i]).parent();var a=null===(t=this.cachedDb.find((t=>t.cachedId===e.attr(this.cacheDbId))))||void 0===t?void 0:t.original;a&&$(e).html(a)}o("yduqs-search-cleaned")}handleClear(){this.setTerm(""),this.clearResults()}handleReset(){this.handleClear(),this.handleClose()}handleInputChange(t){this.setTerm(t.target.value)}setResult(t){this.result=t}navigateOnResults(t){var s=$(`body span.${this.termFoundClass}`);if(this.actualFoundItemPosition=t<0?s.length-1:t>=s.length?0:t,s.eq(this.actualFoundItemPosition)){let t=s.eq(this.actualFoundItemPosition).offset().top;$(window).scrollTop(t-120)}this.handleClose(),o("yduqs-search-navigate",{position:this.actualFoundItemPosition})}handleResultItemClick(t,s){o("yduqs-search-before-navigate",{position:t,page:s}),setTimeout((()=>{this.navigateOnResults(t)}),400)}handleSubmit(t){"submit"===t.type&&t.preventDefault(),this.open?(this.cachedDb||(this.cachedDb=this.createCachedDb()),this.findInDocument()):this.handleOpen()}render(){var t;return s(a,{class:"c-search-bar"},s("form",{class:"c-search-bar-trigger "+(this.open?"opened":""),onSubmit:t=>this.handleSubmit(t)},s("button",{"data-gtm-event-category":"joana:[[instituicao]]:[[tipo-usuario]]","data-gtm-event-action":"barra-busca:conteudo-clique-botao","data-gtm-event-label":"voltar",type:"button",class:"c-button c-button__icon-container u-text--small c-search-bar-trigger-back",onClick:()=>this.handleReset()},s("span",{class:"c-button__icon material-icons"},"arrow_back")),s("div",{class:"c-search-bar-trigger-input-container"},s("input",{type:"search",class:"c-search-bar-trigger-input",onInput:t=>this.handleInputChange(t),value:this.term,ref:t=>this.elemInput=t,placeholder:"Pesquisar no tema"}),this.hasSearch&&s("span",{class:"c-button__icon material-icons",onClick:()=>this.handleClear()},"close")),s("button",{"data-gtm-event-category":"joana:[[instituicao]]:[[tipo-usuario]]","data-gtm-event-action":"barra-busca:conteudo-clique-botao","data-gtm-event-label":"buscar",type:"submit",class:"c-button c-button__icon-container u-text--small c-search-bar-trigger-btn"},s("span",{class:"c-button__icon material-icons"},"search"))),s("div",{class:"c-search-bar-result "+(this.open?"opened":"")},s("div",{class:"c-search-bar-result-overlay",onClick:()=>this.handleClose()}),s("div",{class:"c-search-bar-result-container"},(null===(t=this.result)||void 0===t?void 0:t.length)>0?s("div",{class:"c-search-bar-result-list"},this.result.map((t=>s("div",{class:"c-search-bar-result-list-item",onClick:()=>this.handleResultItemClick(t.index,t.page)},s("div",{class:"item-breadcrumb"},t.locator),s("div",{innerHTML:t.html}))))):this.hasSearch?s("div",{class:"c-search-bar-result-list-empty"},"NÃ£o encontramos nenhum resultado"):s("div",null))))}static get watchers(){return{term:["reset"]}}};export{h as yduqs_search_bar}