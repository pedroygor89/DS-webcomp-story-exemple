import{r as t,c as i,h as s,F as e,a as l}from"./p-3b8a929f.js";const a=class{constructor(s){t(this,s),this.challengeEnd=i(this,"challengeEnd",7),this.error=[],this.usedChances=0,this.hideCount=!1,this.usedTips=0,this.showTip=!1,this.selecteds=[],this.step="loading",this.tutorialItem="tips",this.result=!0,this.showInfo=!0,this.inCountdownDanger=!1,this.ordered=!0,this.dropAttr={onDragOver:t=>this.handleDragOver(t),onDragEnter:t=>this.handleDragEnter(t),onDragLeave:t=>this.handleDragLeave(t),onDrop:t=>this.handleDrop(t)}}handleCountdownFinished(t){var i;t.detail===(null===(i=this.countdownElem)||void 0===i?void 0:i.id)&&(this.showFeedback="negative",this.step="feedback")}handleCountdownDanger(t){var i;t.detail===(null===(i=this.countdownElem)||void 0===i?void 0:i.id)&&(this.inCountdownDanger=!0)}handleGameOver(){this.gameover()}verify(t){return this.ordered?t.id===this.sequence[this.selecteds.length]:this.sequence.includes(t.id)}handleDragStart(t,i){i?t.preventDefault():(this.showInfo=!1,t.dataTransfer.setData("text/plain",t.target.id),t.currentTarget.classList.add("active"))}handleDragEnd(t){t.currentTarget.classList.remove("active")}handleDragOver(t){t.preventDefault()}handleDrop(t){var i,s,e;t.preventDefault(),this.handleDragLeave(t);const l=t.dataTransfer.getData("text"),a=null===(i=this.data)||void 0===i?void 0:i.findIndex((t=>t.id===l));this.verify(this.data[a])||(this.result=!1);const n=[...this.data];n[a].selected=!0,this.data=n,this.selecteds.push(this.data[a]),this.showTip=!1,(null===(s=this.selecteds)||void 0===s?void 0:s.length)===(null===(e=this.sequence)||void 0===e?void 0:e.length)&&(this.showFeedback=this.result?"positive":"negative",this.step="feedback",this.time&&this.countdownElem.pause()),t.dataTransfer.clearData()}handleDragEnter(t){t.target.classList.add("active")}handleDragLeave(t){t.target.classList.remove("active")}handleTip(){"game"===this.step&&(this.showTip||(this.usedTips+=1),this.showTip=!0)}reset(t){this.usedTips=0,this.showFeedback=null,this.selecteds=[],this.step="game",this.showTip=!1,this.result=!0,this.inCountdownDanger=!1,this.data=this.data.map((t=>Object.assign(Object.assign({},t),{selected:!1}))),this.time&&(t?this.countdownElem.stop():this.countdownElem.restart())}async gameover(){return this.usedChances=0,this.reset(!0),this.step="info",Promise.resolve()}setError(t){const i=[...this.error,t];this.error=i}validateFetchedData(t){t?(t.info||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `info`"),".")),t.sequence&&t.sequence.length||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `sequence`"),".")),t.items&&t.items.length||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `items`"),".")),t.positiveFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `positiveFeedback`"),".")),t.negativeFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `negativeFeedback`"),".")),t.failFeedback||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `failFeedback`"),".")),t.dropzone||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `dropzone`"),"."))):this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid `config response`"),"."))}async init(){return await fetch(this.config).then((t=>t.json())).then((t=>{var i,s;this.validateFetchedData(t),this.chances=(null==t?void 0:t.chances)||3,this.ordered=!Boolean(null==t?void 0:t.unordered),this.hideCount=Boolean(null==t?void 0:t.hideCount),this.tips=this.ordered?(null==t?void 0:t.tips)||2:0,this.time=null==t?void 0:t.time,this.info=null==t?void 0:t.info,this.sequence=null==t?void 0:t.sequence,this.positiveFeedback=null==t?void 0:t.positiveFeedback,this.negativeFeedback=null==t?void 0:t.negativeFeedback,this.failFeedback=null==t?void 0:t.failFeedback,this.dropImage=null==t?void 0:t.dropzone,this.data=null===(i=t.items)||void 0===i?void 0:i.map((t=>Object.assign(Object.assign({},t),{selected:!1}))),0===this.tips&&(this.tutorialItem="chances"),(null==t?void 0:t.background)&&(this.hostElem.style.backgroundImage=`url(${t.background})`),(null===(s=this.error)||void 0===s?void 0:s.length)||(this.step="info")})).catch((t=>{this.setError(s("span",null,"Fetched response is invalid:",null==t?void 0:t.toString()))}))}componentWillLoad(){this._id&&this.config?this.init():(this._id||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid attribute `id`"),".")),this.config||this.setError(s("span",null,"yduqs-ordered-dnd-challenge needs a ",s("strong",null,"valid attribute `config`"),".")))}handleNextTutorial(t){var i;"tips"===t?this.tutorialItem="chances":"time"===t||"chances"===t&&!this.time?(this.tutorialItem=void 0,this.showInfo=!1,this.step="game",null===(i=this.countdownElem)||void 0===i||i.start()):"chances"===t?this.tutorialItem=this.hideCount?"time":"count":"count"===t&&(this.tutorialItem="time")}handleCloseFeedback(){this.showInfo=!0,"feedback"===this.step&&("positive"===this.showFeedback?(this.challengeEnd.emit({challenge:this._id,result:!0}),this.usedChances=0,this.reset()):(this.usedChances+=1,this.usedChances===this.chances?(this.challengeEnd.emit({challenge:this._id,result:!1}),this.gameover()):this.reset()))}renderTip(t,i,e,l){return s("span",{class:`c-lab-game-tutorial-tip ${i}`},t,Boolean(l)&&s("button",{type:"button",class:"c-button "+(Boolean(e)?"u-text--small":"c-button__icon-container c-button__icon-small u-text--small p-btn"),onClick:l},Boolean(e)?e:s("i",{class:"p-btn c-button__icon material-icons"},"chevron_right")))}getResultThumb(t,i){let e;return e=this.ordered?this.selecteds[i].id===this.sequence[i]:this.sequence.includes(this.selecteds[i].id),s("div",{class:"item "+(e?"success":"error")},s("img",{src:null==t?void 0:t.thumb,alt:""}),s("i",{class:"material-icons icon "+(e?"success":"error")},e?"sentiment_very_satisfied":"sentiment_dissatisfied"))}startTutorial(){this.showInfo=!1,this.tutorialItem="chances",this.step="tutorial"}render(){var t,i,a,n,h,o,d,r;return s(l,{class:`c-lab-game c-ordered c-ordered-challenge step-${this.step}`,ref:t=>this.hostElem=t},"loading"!==this.step?s(e,null,"tutorial"===this.step&&s("div",{class:"c-lab-game-tutorial-overlay"}),s("header",{class:"c-lab-game-header"},s("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-chances"},[...Array(this.chances)].map(((t,i)=>(t||!t)&&i<this.chances-this.usedChances?s("i",{class:"material-icons active"},i+1===this.chances-this.usedChances&&this.inCountdownDanger?"heart_broken":"favorite"):s("i",{class:"material-icons"},"favorite_border"))),"tutorial"===this.step&&"chances"===this.tutorialItem&&this.renderTip(`Você tem ${this.chances} tentativas`,"bottom",void 0,(()=>this.handleNextTutorial("chances")))),!this.hideCount&&s("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-count"},null===(t=this.selecteds)||void 0===t?void 0:t.length,"/",null===(i=this.sequence)||void 0===i?void 0:i.length,"tutorial"===this.step&&"count"===this.tutorialItem&&this.renderTip(`Você precisa arrastar ${null===(a=this.sequence)||void 0===a?void 0:a.length} itens.`,"bottom",void 0,(()=>this.handleNextTutorial("count")))),this.time&&s("div",{class:"c-lab-game-header-item c-lab-game-tutorial-item c-lab-game-countdown"},s("yduqs-countdown",{id:`${this._id}-countdown`,time:60*this.time,ref:t=>this.countdownElem=t}),"tutorial"===this.step&&"time"===this.tutorialItem&&this.renderTip("Cuidado para não ultrapassar o tempo.","bottom","Começar",(()=>this.handleNextTutorial("time"))))),s("div",{class:"c-lab-game-container"},s("div",{class:`c-lab-game-info ${"tutorial"===this.step?"noIndex":""} ${this.showInfo?"show":"hide"}`},s("div",{class:"c-lab-game-info-text",innerHTML:this.info}),"info"===this.step?s("div",{class:"btns"},s("button",{type:"button",style:{marginRight:"15px"},class:"c-button u-text--small",onClick:()=>this.startTutorial()},"Tutorial"),s("button",{type:"button",class:"c-button u-text--small",onClick:()=>this.handleNextTutorial("time")},"Começar")):s("div",{class:"expand-btn"},s("button",{type:"button",class:"c-button c-button__icon-container c-button__icon-small u-text--small p-btn",onClick:()=>this.showInfo=!this.showInfo},s("i",{class:"p-btn c-button__icon material-icons"},this.showInfo?"chevron_left":"chevron_right")))),s("div",Object.assign({class:"c-lab-game-stage "+("tutorial"===this.step?"noIndex":"")},this.dropAttr),this.dropImage&&s("img",{src:this.dropImage,class:"dropimage",alt:""}),(null===(n=this.selecteds)||void 0===n?void 0:n.length)>0&&(null===(h=[...this.data])||void 0===h?void 0:h.reverse().map((t=>this.selecteds.find((i=>i.id===t.id))?s("img",{src:t.image,class:"preview",alt:""}):"")))),s("div",{class:"c-lab-game-options"},s("div",{class:"c-lab-game-options-scroll"},null===(o=this.data)||void 0===o?void 0:o.map((t=>{const i="game"!==this.step||t.selected||Boolean(this.showFeedback);return s("div",{id:t.id,class:"c-lab-game-options-item "+(i?"disabled":""),draggable:!i,onDragStart:t=>this.handleDragStart(t,i),onDragEnd:t=>this.handleDragEnd(t),style:{backgroundImage:`url(${t.thumb})`}})}))))),"feedback"===this.step&&s("yduqs-modal",{variant:"lab",size:"small",id:`${this._id}-feedback-modal`,isopen:!0},s("div",{class:"c-lab-game-modal-feedback"},"positive"===this.showFeedback?s(e,null,s("div",{class:"content"},s("p",null,this.positiveFeedback)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},"Continuar"))):s(e,null,(null===(d=this.selecteds)||void 0===d?void 0:d.length)>0&&(null===(r=this.selecteds)||void 0===r?void 0:r.length)===this.sequence.length?s(e,null,s("div",{class:"content"},s("p",null,this.usedChances+1===this.chances?this.failFeedback:this.negativeFeedback)),s("div",{class:"result"},this.selecteds.map(((t,i)=>this.getResultThumb(t,i))))):s("div",{class:"content"},s("p",null,"Foi por pouco! Você não finalizou a atividade a tempo e perdeu uma vida.")," ",this.usedChances+1===this.chances&&s("p",null,this.failFeedback)),s("footer",null,s("button",{type:"button",class:"c-button",onClick:()=>this.handleCloseFeedback()},this.usedChances+1===this.chances?"Voltar para Teoria":"Tentar outra vez")))))):s("yduqs-lab-error",{errors:this.error}))}};export{a as yduqs_ordered_dnd_challenge}